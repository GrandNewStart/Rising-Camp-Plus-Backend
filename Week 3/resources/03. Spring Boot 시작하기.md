# Spring Boot 시작하기

**목표**
- 왜 Spring Boot인가?
- Spring Boot는 무엇을 위한 것인가?
- Spring Boot는 어떻게 동작하나?
- Spring Boot vs. Spring MVC vs. Spring

## Spring Boot 이전의 세상
Spring 프로젝트를 세팅하는 것은 매우 복잡한 일이었다.
- pom.xml을 통해 의존성 관리를 해야 하고
- web.xml을 통해 웹앱 설정을 정의해야 하고
- context.xml을 통해 Bean을 관리해야 하고
- NFR(Non Functional Requirements)를 구현해야헀다.
이 많은 작업들을 프로젝트를 생성할 때 마다 해준다니, 이건 아니다!

## Spring Boot의 목적
**PRODUCTION-READY** 어플리케이션을 빠르게 제작한다.
- 빠르게
    - Spring Initializr(start.spring.io)
    - Spring Boot Starter Projects
    - Spring Boot Auto Configuration
    - Spring Boot DevTools
- PRODUCTION-READY
    - 로깅
    - 환경에 따라 다른 설정 (dev, stg, prod)
    - 모니터링 (Spring Boot Actuator)

## Spring Boot의 동작

### Spring Boot Starter Proejcts
어플리케이션을 만들 땐 많은 프레임워크들이 필요하다. Spring Boot Starter Projects는 다양한 프레임워크를 제공하는 공구 세트라고 할 수 있다. Spring Boot는 이런 다양한 스타터 프로젝트를 제공한다.
- spring-boot-starter: 스프링 컨텍스트를 정의할 수 있다.
- spring-boot-starter-web: 웹앱, REST API를 만들 수 있다.
- spring-boot-starter-test: 유닛 테스트를 만들 수 있다.
- spring-boot-starter-json: Bean과 JSON간의 변환을 가능하게 한다.
- spring-boot-starter-tomcat: 톰캣으로 앱을 구동할 수 있게 한다.
- spring-web
- spring-webmvc

### Spring Boot Auto Configuration
스프링 앱을 개발하는데 많은 설정들이 필요하다. Spring Boot Auto Configuration은 이를 간소화 하는데 도움을 준다. 이는 org.springframework.boot:spring-boot-autoconfigure 라는 패키지 이름으로 jar 파일로 설치되어있을 것이다. 이 안에 각종 스프링 프레임워크에 대한 자동 설정 기능들이 들어가있다. src > main > resources > application.properties에 'logging.level.org.springframework=info' 처럼 설정을 선언하여 세부 설정을 커스터마이징 할 수 있다.

### Spring Boot Dev Tools
Hot reload로 디버깅 속도를 단축시켜준다. 다만 IntelliJ IDEA에선 작동하지 않는 듯 하다...그리고 pom.xml이 바뀌면 무조건 다시 빌드해야된다.
 
## 프로덕션 환경 배포 준비

### Profile
어플리케이션은 dev, qa, stg, prod 등 다양한 환경을 가질 수 있다. 각 환경은 각자의 설정이 필요하다. 각 환경마다 다른 데이터베이스, 다른 웹서비스 등이 필요하다는 것이다. 그리고 이것을 Profile을 통해 적용 가능하다. src > main > java > resources > application.properties-{환경 이름}과 같은 파일을 만들어 여기에 각 환경마다 필요한 설정 값을 입력한다. 그리고 메인 설정 파일이라 할 수 있는 src > main > java > resources > application.properties에는 다음과 같은 설정값을 넣음으로써 적용할 profile을 지정한다: spring.profiles.active=prod
```
(src > main > resources)

application.properties
application-dev.properties
application-stg.properties
application-prod.properties
```
```
(application.properties)

spring.profiles.active=dev
```

### ConfigurationProperties
Profile에 정의한 설정 값을 코드에서 사용하려면 이를 위한 컴포넌트를 만들면 된다. 예를들어 다음과 같은 설정 값을 선언했다고 하자.
```
spring.profiles.active=dev

currency-service.url=https://default.ade.com
currency-service.username=deafultusername
currency-service.key=defaultkey
``` 
이는 활성화 할 설정이 'application-dev.properties'라는 뜻이고, 그 아래 'currency-service'의 url, username, key 값으로 각각 'https://default.ade.com', 'defaultusername', 'key'를 넣어줬다는 뜻이다. 그럼 이를 실제 코드에서 사용하기 위해선 다음과 같이 컴포넌트 클래스를 만들어주면 된다.  
```java
@ConfigurationProperties(prefix = "currency-service")
@Component
public class CurrencyServiceConfiguration {

    private String url;
    private String username;
    private String key;

    public String getUrl() {
        return url;
    }

    public void setUrl(String url) {
        this.url = url;
    }

    public String getUsername() {
        return username;
    }

    public void setUsername(String username) {
        this.username = username;
    }

    public String getKey() {
        return key;
    }

    public void setKey(String key) {
        this.key = key;
    }
}
```
이렇게 하면 자동으로 CurrencyServiceConfiguration 객체가 생성되고 초기화되는데, 이를 확인하기 위해 다음과 같은 REST API 클래스를 만들자.
```java
@RestController
public class CurrencyConfigurationController {

    @Autowired
    private CurrencyServiceConfiguration configuration;

    @RequestMapping("/currency-configuration")
    public CurrencyServiceConfiguration retrieveAllCourses() {
        return configuration;
    }

}
```


### Embedded Server

### Actuator
