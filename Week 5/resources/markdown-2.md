# 인증 & 인가

- 인증은 로그인
    - ID & PW
    - OAuth
- 인가는 권한 식별
    - 쿠키
    - 세션
    - JWT

## 쿠키

클라이언트가 어떤 웹페이지를 방문할 때, 클라이언트의 브라우저에 설치되는 기록 정보 파일. 무상태성 환경에서 기억하고자 하는 데이터를 쿠키에 담고, 다음 요청에 그 쿠키를 담아 보냄으로써 무상태를 극복.

과정

1. 로그인 요청

2. 로그인 성공, 서버는 회원정보를 담은 쿠키를 담아 응답

3. 사용자는 브라우저 저장소에 쿠키 저장

4. 사용자는 다음번 요청 시, 쿠키를 함꼐 전달

5. 서버는 쿠키를 보고 이용자를 식별
    
단점
- 보안에 취약: 개인 정보가 외부에 노출, 유출 및 조작될 가능성
- 브라우저간 공유 불가: 브라우저 마다 쿠키 지원 형태가 다르므로 호환 불가
- 용량 문제: 쿠키는 작은 정보만 담을 수 있다.
- 쿠키 사이즈: 쿠키 사이즈가 커질수록 네트워크 부하가 심해진다.

## 세션

세션은 클라이언트가 아닌 서버쪽에서 인증 정보를 관리한다. 쿠키가 외부에 노출되더라도 그 안엔 유의미한 개언정보가 없기 때문에 쿠키보다 안전하다.

과정

1. 로그인 요청

2. 로그인 성공, 서버에서 세션 ID 생성 & 저장

3. 쿠키에 세션 ID 정보를 담아 응답

4. 사용자는 브라우저 저장소에 쿠키 저장

5. 사용자는 다음번 요청 시, 쿠키를 함께 전달

6. 서버는 쿠키를 확인하여 세선 ID에 대응하는 유저를 식별함

단점
- 개인정보 직접 노출을 제외하곤 쿠키와 동일하다
- 해커가 쿠키를 탈취, 사용자인 척 할 수 있다
- 서버에 부담

## JWT(JSON Web Token)

인증에 필요한 정보들을 암호화한 토큰. JWT를 HTTP 헤더에 실어 서버가 클라이언트를 식별. 즉, JWT가 쿠키를 대체.

구조
- '.'을 구분자로 세가지 부분으로 나뉜다.
- Header: 해싱 알고리즘, 토큰 타입 정보.
- Payload: 핵심 정보. 주로 사용자의 식별자, 유효기간 등을 포함.
- Signature: Encode(Header + Payload)를 서버 비밀키로 해싱하여 생성

인가 과정

1. 로그인 요청

2. 로그인 성공, 인증 정보를 Payload에 담고 비밀키를 통해 JWT 발급

3. 서버는 클라이언트에게 JWT를 전달

4. 클라이언트는 JWT를 어떤 형태로든 저장, 요청을 보낼 때 마다 헤더(Authorization)에 담아 보낸다

5. 서버는 전달받은 JWT의 헤더, 페이로드에 비밀키를 더해 암호화

6. 서버는 암호화된 값이 JWT의 서명 부분과 일치하는지 판단, 유호기간도 판단

7. 유효한 토큰이면 요청에 응답

---

## OAuth

인터넷 사용자들이 비밀번호를 제공하지 않고 다른 웹사이트 상의 자신들의 정보에 대해 웹사이트나 애플리케이션의 접근 권한을 부여할 수 있는 공통적인 수단으로서 사용되는, 접근 위임을 위한 개방형 표준. 즉, 페북/구글/카카오 로그인 등의 외부 서비스의 로그인 방식으로 인증하는 방법

### 참여자
- Resource Server: Client가 사용하고자 하는 정보를 보유하고 있는 서버 (Facebook, Google, Twitter)
- Resource Owner: 정보의 소유자, 유저.
- Client: Resource Server에 접속해서 정보를 가져오고자 하는 클라이언트(웹/앱 어플리케이션)

### 과정

- 등록

    1. Client -(등록)-> Resource Server

    2. Resource Server -(Client ID, Client Secret)-> Client

- 인증코드 발급

    1. Resource Owner가 Client의 소셜 로그인 버튼을 클릭

    2. Resource Owner는 Resource Server로 리다이렉트

    3. Resource Server는 Client의 ID, Secret을 확인. 인증되면 로그인을 승인

    4. Resource Owner에게 Client로 정보 위임 권한을 줄 것읜지 확인

    5. Resource Owner가 동의를 마치면 Resource Server는 Client가 등록한 리다이렉션 URL로 인증코드를 담아 요청

- Access Token 인증

    1. Client는 ID, 패스워드, 발급받은 인증코드를 Resource Server에 전달
    
    2. Resource Server는 전달받은 정보를 검사하고 유효한 요청이면 Access Token 발급

- 유저 정보 조회

    1. Client는 Access Token을 헤더에 담아 Resource Server로 전송
    
    2. Resource Server는 Access Token을 검증하고 Client에게 유저 정보를 반환
    
    3. Client는 유저 정보로 회원가입 혹은 로그인 기능 수행
    
    4. Client는 JWT 토큰을 발급하여 인가 처리 수행

### 구현 방법

    1. Resource Server에 내 서비스를 Client로 등록
    
    2. Resource Server 로그인 페이지로 리다이렉션하는 API 제작(인증코드 발급)
    
    3. Resource Server 로그인 인증 후, 인증코드를 담은 리다이렉션 요청을 받는 API 제작
    
    4. 인증코드를 헤더에 담아 Access Token을 받아오고 이를 다시 담아 유저 정보를 받아오는 로직 구현
    
    5. 받아온 정보를 활용해 회원가입/로그인 기능 구현
    
    6. 받아온 정보로 JWT 토큰을 만들어 Client에 응답 
